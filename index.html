<html>
    <head>
        <title>
            Exercicio Lista de tarefas
        </title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0";/>
        <style>
            *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica';
        }
        body{
            background: rgb(10, 90, 77);
        }
        section.container{
            background-color: white;
            max-width: 600px;
            height: auto;
            padding: 5%;
            margin: 100px auto;
            border-radius: 20px;
            font-weight: bold;
        }
        section.container h1{
            margin-bottom:10px;
            font-size: 30px;
            border-bottom: 1px solid #ccc;
        }
        section.container p{
           
           margin-top: 20px;
        }
        input.input-tarefa{
            font-size: 15px;
            padding: 2%;
        }
        button{
            background-color: rgb(10, 90, 77);
            color: white;
            cursor: pointer;
            font-size: 15px;
            padding: 2%;
            border-radius: 10px;
            margin-top: 10px;
            border: none;
        }

        </style>        
    </head>
    
    <body>
        <section class="container">
            <h1>Lista de tarefas</h1>
            <p>
                <input type="text" class="input-tarefa"/>
                <button class="btn-tarefa">Adicionar tarefa</button>
            </p>
            <ul class="tarefas"></ul>
        </section>
    <script>
        const inputTarefa = document.querySelector('.input-tarefa');
        const btnTarefa = document.querySelector('.btn-tarefa');
        const tarefas = document.querySelector('.tarefas');

        function criaLi(){
            const li = document.createElement('li');
            return li;
        }

        inputTarefa.addEventListener('keypress', function(e){
            if(e.keyCode === 13){
                if(!inputTarefa.value) return;
                criaTarefa(inputTarefa.value);
            }
        });

        function limpaInput(){
            inputTarefa.value = '';
            inputTarefa.focus();
        }
        function criaBotaoApagar(li){
            li.innerHTML += ' '; 
            const botaoApagar = document.createElement('button');
            botaoApagar.innerText = 'Apagar';
            botaoApagar.setAttribute('class','apagar');
            botaoApagar.setAttribute('title','Apagar esse texto');
            li.appendChild(botaoApagar);
        }
        function criaTarefa(textoInput){
            const li =criaLi();
            li.innerHTML = textoInput;
            tarefas.appendChild(li);
            limpaInput();
            criaBotaoApagar(li);
            salvarTarefas();
        }


        btnTarefa.addEventListener('click', function(){
            if(!inputTarefa.value) return;
            criaTarefa(inputTarefa.value);
        })
        document.addEventListener('click',function(e){
            const el = e.target;
            if(el.classList.contains('apagar')){
                el.parentElement.remove();
                salvarTarefas();
            }
        });

        function salvarTarefas(){
            const liTarefas= tarefas.querySelectorAll('li');
            const listaDeTarefas = [];

            for(let tarefa of liTarefas){
                let tarefaTexto = tarefa.innerText;
                tarefaTexto = tarefaTexto.replace('Apagar','').trim();
                listaDeTarefas.push(tarefaTexto)
            }
            const tarefasJSON = JSON.stringify(listaDeTarefas);
            localStorage.setItem('tarefas', tarefasJSON);
        }

        function adicionaTarefasSalvas(){
            const tarefas = localStorage.getItem('tarefas');
            const listaDeTarefas = JSON.parse(tarefas);
            
            for (let tarefa of listaDeTarefas){
                criaTarefa(tarefa);
            }
        
        }
        adicionaTarefasSalvas();
    </script>
    </body>
</html>